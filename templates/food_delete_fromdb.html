<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <!-- 글자 인코딩 한국어 안깨지게 -->
    <title>FINE - 삭제 페이지</title>
    <!-- 웹 이름 설정 -->
    <style>
        body {
            font-family: Arial, sans-serif; /* 글자설정 */
            background-color: #f9f9f9; /* 배경색 회색 */
            color: #333; /* 검정색 */
            margin: 0; /* 모든 요소 여백 없애기 */
            padding: 0; /* 모든 요소 여백 없애기 */
        }
        .container {
            width: 100%; /* 화면 너비 100% */
            height: 100vh; /* 화면 높이 100% */
            box-sizing: border-box; /* 너비와 높이가 패딩과 테두리를 포함 */
            padding: 20px; /* 안쪽 여백 설정 */
        }
        .title {
            font-size: 48px; /* 글자 크기 */
            font-weight: bold; /* 글자 굵게 */
            color: #2a9d8f; /* 글자 청록색 */
            margin-bottom: 20px; /* 글자 아래 여백 */
            text-align: center; /* 글자 가운데 정렬 */
            margin-top: 0; /* 글자 위 여백 */
        }
        .title a {
            color: #2a9d8f; /* 링크 색 청록색 */
            text-decoration: none; /* 링크에 밑줄 제거 */
        }
        .search-container {
            display: block; /* block 방식 사용 */
            gap: 10px; /* 버튼 사이 간격 설정 */
            margin-bottom: 20px; /* 검색 박스랑 아래 여백 간격 */
            width: 100%; /* 검색 영역 너비 100% 설정 */
        }
        .search-input {
            width: calc(100% - 120px); /* 버튼 크기를 제외한 나머지 너비를 100%로 설정 */
            padding: 10px; /* 텍스트 안쪽 여백 설정 */
            border: 1px solid #ccc; /* 테두리 회색 */
            border-radius: 5px; /* 모서리 둥글게 */
            font-size: 16px; /* 글자 크기 */
            box-sizing: border-box; /*  너비와 높이가 패딩과 테두리를 포함한 값으로 설정 */
            display: inline-block; /* 한줄에 표시 */
        }
        .search-button {
            width: 100px; /* 버튼의 고정된 너비 설정 */
            padding: 10px 20px; /* 버튼 내부 여백 설정 위, 아래 10px, 왼쪽, 오른쪽 20px */
            font-size: 16px; /* 글자 크기 */
            font-weight: bold; /* 글자 굵게 */
            color: white; /* 글자 색 흰색 */
            background-color: #2a9d8f; /* 버튼 배경색 청록색 */
            border: none; /* 테두리 제거 */
            border-radius: 5px; /* 모서리 둥글게 */
            cursor: pointer; /* 버튼 위에 마우스를 올렸을 때 포인터 커서로 변경 */
            box-sizing: border-box; /*  너비와 높이가 패딩과 테두리를 포함한 값으로 설정 */
            display: inline-block; /* 한줄에 표시 */
            margin-left: 15px; /* 버튼과 입력창 사이에 15px 간격 추가 */
        }
        .search-button:hover {
            background-color: #21867a; /* 검색에 마우스 갖다대면 살짝 어두운 청록색 */
        }
        .error-message {
            color: red; /* 글자 빨강 */
            margin: 10px 0; /* 여백 간격 설정 */
            font-weight: bold; /* 글자 굵게 */
        }
        table {
            width: 100%; /* 너비 100% */
            border-collapse: collapse; /* 셀 경계 안겹치게 */
            margin-top: 20px; /* 상단 여백 설정 */
            font-size: 14px; /* 글자 크기 */
        }
        table th, table td { /* 테이블 헤더 셀, 데이터 셀 */
            padding: 12px; /* 내용과 테두리 사이 여백 설정 */
            text-align: center; /* 글자 가운데 정렬 */
            border: 1px solid #ddd; /* 회색 테두리 설정 */
        }
        table th {
            background-color: #f4f4f4; /* 헤더셀 연한 회색 설정 */
            font-weight: bold; /* 글자 굵게 */
        }
        table td .delete-button {
            background-color: #e76f51; /* 삭제 버튼 배경 빨강 */
            color: white; /* 글자색 흰색 */
            padding: 5px 10px; /* 버튼 내부 여백 설정 위, 아래 5px, 왼쪽, 오른쪽 10px */
            font-size: 14px; /* 글자 크기 */
            border: none; /* 테두리 제거 */
            border-radius: 5px; /* 모서리 둥글게 */
            cursor: pointer; /* 버튼 위에 마우스를 올렸을 때 포인터 커서로 변경 */
        }
        table td .delete-button:hover {
            background-color: #d65a42; /* 삭제에 마우스 갖다대면 살짝 어두운 빨강색 */
        }
        table td .update-button {
            background-color: #63a7ac; /* 업데이트 버튼 배경 파랑색 */
            color: white; /* 글자색 흰색 */
            padding: 5px 10px; /* 버튼 내부 여백 설정 위, 아래 5px, 왼쪽, 오른쪽 10px */
            font-size: 14px; /* 글자 크기 */
            border: none; /* 테두리 제거 */
            border-radius: 5px; /* 모서리 둥글게 */
            cursor: pointer; /* 버튼 위에 마우스를 올렸을 때 포인터 커서로 변경     */
        }
        table td .update-button:hover {
            background-color: #436968; /* 업데이트에 마우스 갖다대면 살짝 어두운 파랑색 */
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title"><a href="/">FINE</a></h1>
        <!-- 메인 타이틀에 링크 추가 -->
        <div class="search-container">
            <form method="POST" action="/food_delete_fromdb">
                <!-- 서버로 전송 -->
                <input type="text" class="search-input" name="keyword" placeholder="음식명을 입력하세요">
               <!-- 텍스트 박스 생성 및 글씨 띄우기 -->
                <button class="search-button" type="submit">검색</button>
                <!-- 검색 버튼 생성 -->
            </form>
        </div>     
        {% if error_message %}
        <div class="error-message" style="color: red; text-align: center; margin-bottom: 20px;">{{ error_message }}</div>
        {% endif %}
        <!-- 검색에서 입력안하거나 없는 내용일 때 에러 메시지 띄우기 -->
        <table>
            <thead>
                <tr>
                    <!-- 헤더셀 제목 작성 -->
                    <th>음식명</th>
                    <th>칼로리 (Cal)</th>
                    <th>탄수화물 (g)</th>
                    <th>단백질 (g)</th>
                    <th>지방 (g)</th>
                    <th>콜레스테롤 (mg)</th>
                    <th>식이섬유 (g)</th>
                    <th>나트륨 (mg)</th>
                    <th>삭제</th>
                    <th>업데이트</th>
                </tr>
            </thead>
            <tbody>
                {% for item in food_data %}
                <tr>
                    <td contenteditable="true" class="editable" data-column="food_name">{{ item[0] }}</td>
                    <td contenteditable="true" class="editable" data-column="calories">{{ item[2] }}</td>
                    <td contenteditable="true" class="editable" data-column="carbs">{{ item[3] }}</td>
                    <td contenteditable="true" class="editable" data-column="protein">{{ item[4] }}</td>
                    <td contenteditable="true" class="editable" data-column="fat">{{ item[5] }}</td>
                    <td contenteditable="true" class="editable" data-column="cholesterol">{{ item[6] }}</td>
                    <td contenteditable="true" class="editable" data-column="fiber">{{ item[7] }}</td>
                    <td contenteditable="true" class="editable" data-column="sodium">{{ item[8] }}</td>
                    <td>
                        <form method="POST" form id="delete-form">
                            <input type="hidden" name="food_name_d" value="{{ item[0] }}">
                            <input type="hidden" name="food_code_d" value="{{ item[1] }}">
                            <button class="delete-button" id="delete-button" type="submit">삭제</button>
                            <!-- 삭제 버튼 생성 및 누를 시 문구 띄우기 -->
                        </form>
                    </td>
                    <td>
                        <form method="POST" form id="update-form" action="/food_delete_fromdb">
                            <input type="hidden" name="food_name" value="{{ item[0] }}">
                            <input type="hidden" name="food_code" value="{{ item[1] }}">
                            <input type="hidden" name="calories" value="{{ item[2] }}">
                            <input type="hidden" name="carbs" value="{{ item[3] }}">
                            <input type="hidden" name="protein" value="{{ item[4] }}">
                            <input type="hidden" name="fat" value="{{ item[5] }}">
                            <input type="hidden" name="cholesterol" value="{{ item[6] }}">
                            <input type="hidden" name="fiber" value="{{ item[7] }}">
                            <input type="hidden" name="sodium" value="{{ item[8] }}">
                            <button class="update-button" id="update-button" type="submit">업데이트</button>
                        </form>
                    </td>           
                </tr>
                {% endfor %}
            </tbody> 
        </table>
        <script>
            // 셀을 더블클릭했을 때 내용을 수정 가능하게 만들기
            const editableCells = document.querySelectorAll('.editable');
        
            editableCells.forEach(cell => {
                cell.addEventListener('dblclick', function() {
                    this.contentEditable = 'true'; // 셀을 편집 가능 상태로 만들기
                    this.focus(); // 셀에 포커스를 맞추기
                });
        
                // 편집이 끝난 후, 값을 자동으로 hidden input에 반영
                cell.addEventListener('blur', function() {
                    this.contentEditable = 'false'; // 편집이 끝나면 비활성화
                    const column = this.getAttribute('data-column');
                    const value = this.innerText; // 수정된 값
                    const hiddenInput = this.closest('tr').querySelector(`input[name="${column}"]`);
                    if (hiddenInput) {
                        hiddenInput.value = value; // hidden input에 수정된 값 반영
                    }
                });
            });

            const deleteButtons = document.querySelectorAll('.delete-button'); // 모든 삭제 버튼을 선택
            const updateButtons = document.querySelectorAll('.update-button'); // 모든 업데이트 버튼을 선택       
            // 삭제 버튼에 대한 이벤트 리스너
            deleteButtons.forEach(button => {
                button.addEventListener('click', function(event) {
                    event.preventDefault(); // 기본 제출 동작 방지
                    alert('음식이 삭제되었습니다!');
                    
                    // 버튼이 속한 폼을 찾아서 폼 제출
                    const form = this.closest('form');
                    if (form) {
                        form.submit(); // 해당 폼 제출
                    }
                });
            });

            // 업데이트 버튼에 대한 이벤트 리스너
            updateButtons.forEach(button => {
                button.addEventListener('click', function(event) {
                    event.preventDefault(); // 기본 제출 동작 방지
                    alert('음식이 업데이트되었습니다!');
                    
                    // 버튼이 속한 폼을 찾아서 폼 제출
                    const form = this.closest('form');
                    if (form) {
                        form.submit(); // 해당 폼 제출
                    }
                });
            });
        </script>
    </div>
</body>
</html>